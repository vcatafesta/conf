#user nobody;
user http;
worker_processes auto;
#pid			/run/nginx.pid;

error_log	/var/log/nginx/error.log;
error_log	/var/log/nginx/error.log  notice;
error_log	/var/log/nginx/error.log  info;
worker_rlimit_nofile 8192;

events {
	worker_connections  1024;
}

http {
#       client_max_body_size 32M;
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        include /etc/nginx/mime.types;
        access_log  /var/log/nginx/access.log;
        default_type application/octet-stream;
        ssl_prefer_server_ciphers on;
        gzip on;
        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
			#	include		mime.types;
			include		proxy.conf;
			#	include		fastcgi.conf;
			#	index			index.html index.htm index.php;
			#	default_type  application/octet-stream;

   #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
   #                  '$status $body_bytes_sent "$http_referer" '
   #                  '"$http_user_agent" "$http_x_forwarded_for"';

   #access_log  logs/access.log  main;

	disable_symlinks off;
#  sendfile				on;
#  tcp_nopush			on;
#	keepalive_timeout	65;
#	tcp_nodelay			on;
#	gzip					on;
	server_names_hash_bucket_size 128; # this seems to be required for some vhosts
	#upstream appserver  { server 127.0.0.1:9010; }

    server {
         listen       80;
			server_name  localhost www.localhost.com;
         root  /github/ChiliOS;
         index index.html index.htm index.php;
#			types_hash_max_size 4096;

         location / {
				autoindex on;
				try_files $uri $uri/ =404;
			}

			include fcgiwrap.conf;
#			include php_fastcgi.conf;
		}

    server {
#        listen 86 default_server;
#        server_name _;
         listen 86;
         server_name sena;
#			modsecurity on;
#			types_hash_max_size 4096;
         root  /opt/sena;
         index index.php index.html index.htm;

        location / {
 #          proxy_pass http://localhost:80;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection keep-alive;
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#           proxy_set_header X-Forwarded-Proto $scheme;
#				autoindex on;
				try_files $uri $uri/ =404;
			}

        location ~ .php$ {
           include php_fastcgi.conf;
           fastcgi_pass unix:/var/run/php/php-fpm.sock;
			}

			include fcgiwrap.conf;
      }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}

    server {
			listen       81;
   #     listen       somename:8080;
	#		server_name  somename  alias  another.alias;
			server_name  proxy;
			types_hash_max_size 4096; 

         location / {
            root   /home/sci-work;
            index  index.html index.htm;
            autoindex on;
        }
    }


    # HTTPS server
#    server {
 #       listen       443 ssl;
  #      server_name  localhost;
#
 #       ssl_certificate      /etc/ssl/cert.pem;
  #      ssl_certificate_key  cert.key;
#
 #       ssl_session_cache    shared:SSL:1m;
  #      ssl_session_timeout  5m;
#
 #       ssl_ciphers  HIGH:!aNULL:!MD5;
  #      ssl_prefer_server_ciphers  on;

	#		 location / {
    #        root  /github/ChiliOS;
     #       index index.html index.htm index.php;
      #      autoindex on;
       #     include php_fastcgi.conf;

        # }
    #}

    server {
			listen       82;
			server_name  blfs-git;
			types_hash_max_size 4096;

         location / {
            root   /srv/http/blfs-systemd;
            index  index.html index.htm index.xml;
            autoindex on;
			}
		}

    server {
			listen       83;
			server_name  lfs;
			types_hash_max_size 4096;

         location / {
            root   /mnt/lfs/srv/http/chili/;
            index  index.html index.htm index.xml;
            autoindex on;
			}
		}

    server {
			listen       84;
			server_name  dell;
			types_hash_max_size 4096;

         location / {
            root   /mnt/dell/srv/http/chili/;
            index  index.html index.htm index.xml;
            autoindex on;
			}
		}

    server {
			listen       85;
			server_name	mazonos;
			types_hash_max_size 4096;

			location / {
         root			/github/mazonos;
         index			index.html index.htm index.xml index.php;
			autoindex on;

			add_header Cache-Control "max-age=0, no-cache, no-store, must-revalidate";
         add_header Pragma "no-cache";

			# kill cache
			add_header Last-Modified $date_gmt;
			add_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
			if_modified_since off;
#			expires off;
			etag off;
			try_files $uri $uri/ =404;
			set $skip_cache 0;
         # don't cache it
         proxy_no_cache 1;
         # even if cached, don't try to use it
         proxy_cache_bypass 1;
        expires -1;
		}
	}

server {
        listen   90;
        server_name  localhost;
        access_log  /var/log/nginx/access.log;

        location / {
                root   /github/ChiliOS/;
                autoindex on;
                index  index.html index.htm;
        }

			location ~ \.(cgi|py|sh|pl|lua|rb)$ {
               root    /github/ChiliOS/cgi-bin;
					autoindex on;
					try_files $uri $uri/ =404;
               rewrite ^/cgi-bin/(.*)\.cgi /$1.cgi break;
               rewrite ^/cgi-bin/(.*)\.sh  /$1.sh break;
               rewrite ^/cgi-bin/(.*)\.py  /$1.py break;
               rewrite ^/cgi-bin/(.*)\.pl  /$1.pl break;
               rewrite ^/cgi-bin/(.*)\.lua /$1.lua break;
               rewrite ^/cgi-bin/(.*)\.rb  /$1.rb break;
               include /etc/nginx/fastcgi_params;
               fastcgi_pass   unix:/run/fcgiwrap.socket;
               fastcgi_param  SCRIPT_FILENAME  /github/ChiliOS/cgi-bin$fastcgi_script_name;
        }
	}
}
